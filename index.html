<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galactic Blog</title>
    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
    <script src="https://unpkg.com/3d-force-graph@1.73.1/dist/3d-force-graph.min.js"></script>
    <script src="https://unpkg.com/three-spritetext@1.8.2/dist/three-spritetext.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background-color: #000; color: #fff; font-family: 'Segoe UI', sans-serif; cursor: url('data:image/svg+xml;utf8,<svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 5L12 21L15.5 13.5L23 10L5 5Z" fill="white" stroke="%23333" stroke-width="2.5" stroke-linejoin="round" style="filter:drop-shadow(0px 2px 3px rgba(0,0,0,0.3));"/></svg>') 6 6, auto; }
        #3d-graph { width: 100vw; height: 100vh; position: absolute; z-index: 1; }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        ::-webkit-scrollbar-thumb { background: rgba(100, 150, 255, 0.3); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(100, 150, 255, 0.6); }

        .search-wrapper { position: fixed; top: 20px; right: 30px; z-index: 50; width: 240px; }
        #search-container { background: rgba(10, 15, 25, 0.85); border: 1px solid rgba(100, 150, 255, 0.3); border-radius: 20px; padding: 8px 16px; display: flex; align-items: center; backdrop-filter: blur(8px); transition: all 0.3s; }
        #search-container:focus-within { border-color: rgba(100, 200, 255, 0.9); box-shadow: 0 0 20px rgba(0, 100, 255, 0.3); }
        #search-input { background: transparent; border: none; color: #fff; outline: none; font-size: 14px; width: 100%; margin-left: 8px; font-family: inherit; }
        #search-results { margin-top: 10px; background: rgba(8, 10, 16, 0.95); border: 1px solid rgba(40, 50, 70, 0.8); border-radius: 12px; max-height: 400px; overflow-y: auto; display: none; box-shadow: 0 10px 40px rgba(0,0,0,0.8); }
        #search-results.active { display: block; }
        .search-item { padding: 12px 15px; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 13px; color: #ccc; display: flex; justify-content: space-between; align-items: center; transition: background 0.2s; }
        .search-item:hover, .search-item.selected { background: rgba(30, 100, 200, 0.3); color: #fff; }
        .search-tag { font-size: 11px; color: #88a; background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; }

        #helicopter-cat { position: fixed; pointer-events: none; z-index: 9999; transform: scale(0.65); transform-origin: top left; width: 32px; height: 24px; top: -100px; left: -100px; }
        .cat-body-container { width: 100%; height: 100%; position: relative; animation: float 2.5s ease-in-out infinite; }
        .cat-body { width: 32px; height: 22px; background: #fff; border-radius: 16px 16px 12px 12px; box-shadow: 0 0 15px rgba(255, 255, 255, 0.5); position: absolute; bottom: 0; display: flex; justify-content: center; align-items: center; }
        .cat-ear { position: absolute; top: -4px; width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-bottom: 10px solid #fff; }
        .cat-ear.left { left: 3px; transform: rotate(-15deg); }
        .cat-ear.right { right: 3px; transform: rotate(15deg); }
        .cat-face { position: absolute; top: 8px; width: 100%; display: flex; justify-content: center; gap: 6px; }
        .eye { width: 3px; height: 3px; background: #333; border-radius: 50%; transition: 0.1s; }
        .eye.closed { height: 1px; transform: scaleX(1.5); background: #555; }
        .propeller { position: absolute; top: -10px; left: 50%; width: 28px; height: 2px; background: rgba(255, 255, 255, 0.9); transform: translateX(-50%); animation: spin 0.08s linear infinite; }
        .propeller::after { content: ''; position: absolute; top: 100%; left: 50%; width: 2px; height: 6px; background: #ccc; transform: translateX(-50%); }
        #zzz-bubble { position: absolute; top: -20px; right: -15px; font-size: 10px; color: #fff; font-weight: bold; opacity: 0; transition: opacity 0.5s; }
        #zzz-bubble.active { opacity: 0.9; animation: floatUp 2s infinite; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 0.8; } 100% { transform: translateY(-10px); opacity: 0; } }
        @keyframes spin { 0% { transform: translateX(-50%) rotateY(0deg); } 100% { transform: translateX(-50%) rotateY(360deg); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(4px); } }

        #article-modal { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(5, 5, 8, 0.96); z-index: 1000; opacity: 0; transition: opacity 0.3s; overflow-y: auto; }
        #article-modal.active { display: block; opacity: 1; }
        .article-content { max-width: 800px; margin: 60px auto; padding: 40px; background: rgba(20, 25, 35, 0.4); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; }
        .close-btn { position: fixed; top: 30px; right: 50px; font-size: 32px; cursor: pointer; color: #888; z-index: 1100; }
        .close-btn:hover { color: #fff; }
        .markdown-body { line-height: 1.7; color: #d0d7de; }
        .markdown-body h1 { border-bottom: 1px solid #30363d; padding-bottom: 0.3em; margin-top: 1.5em; color: #fff; }
        .markdown-body a { color: #58a6ff; text-decoration: none; }
        .markdown-body code { background: rgba(110, 118, 129, 0.4); padding: 0.2em 0.4em; border-radius: 6px; font-family: monospace; }
        .markdown-body pre { background: #161b22; padding: 16px; border-radius: 6px; overflow: auto; }
        .markdown-body img { max-width: 100%; border-radius: 6px; }
    </style>
</head>
<body>
    <div id="3d-graph"></div>
    <div id="helicopter-cat"><div class="cat-body-container"><div id="zzz-bubble">Zzz...</div><div class="propeller"></div><div class="cat-ear left"></div><div class="cat-ear right"></div><div class="cat-body"><div class="cat-face"><div class="eye left"></div><div class="eye right"></div></div></div></div></div>
    <div class="search-wrapper"><div id="search-container"><span class="search-icon">üîç</span><input type="text" id="search-input" placeholder="Search universe..." autocomplete="off"/></div><div id="search-results"></div></div>
    <div id="article-modal"><div class="close-btn" onclick="closeArticle()">&times;</div><div class="article-content markdown-body" id="markdown-container"></div></div>
    
    <script>
        let Graph, maxDegree = 1;
        let highlightNodes = new Set(), highlightLinks = new Set();
        let hoverNode = null, initialCameraPos = null, starryParticles = null;

        const modal = document.getElementById('article-modal');
        const box = document.getElementById('markdown-container');
        
        // Ê†∏ÂøÉ‰∫§‰∫íÔºöÊâìÂºÄÊñáÁ´†
        function openArticle(node) {
            if(!node) return;
            const content = node.content || (node.data && node.data.content) || "# No Content";
            box.innerHTML = marked.parse(content);
            modal.classList.add('active');
        }
        function closeArticle() {
            modal.classList.remove('active');
            if(initialCameraPos && Graph) Graph.cameraPosition(initialCameraPos, {x:0,y:0,z:0}, 1500);
        }
        document.addEventListener('keydown', e => { if(e.key==='Escape') closeArticle(); });

        // Ëâ≤Ê∏©ÁÆóÊ≥ï
        function getStarColor(degree) {
            const t = Math.pow(degree / maxDegree, 0.7); 
            const c1 = new THREE.Color(0xff4433), c2 = new THREE.Color(0xffddaa), c3 = new THREE.Color(0x66ccff);
            if (t < 0.4) return c1.clone().lerp(c2, t * 2.5).getStyle();
            else return c2.clone().lerp(c3, (t - 0.4) * 1.6).getStyle();
        }

        // ËßÜËßâÁîüÊàêÂô®
        function createGlowSprite(color, size, degree) {
            const canvas = document.createElement('canvas'); canvas.width = 128; canvas.height = 128; 
            const ctx = canvas.getContext('2d'); const c = 64;
            const grad = ctx.createRadialGradient(c, c, 3, c, c, 20);
            grad.addColorStop(0, 'rgba(255,255,255,1)'); grad.addColorStop(0.4, color); grad.addColorStop(1, 'rgba(0,0,0,0)');
            ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(c, c, 20, 0, Math.PI*2); ctx.fill();
            
            ctx.globalCompositeOperation = 'lighter';
            const rayScale = 0.5 + (degree / maxDegree);
            const drawRay = (w, h, a) => {
                const g = ctx.createLinearGradient(0, c-h, 0, c+h);
                g.addColorStop(0,'rgba(0,0,0,0)'); g.addColorStop(0.5,`rgba(255,255,255,${a})`); g.addColorStop(1,'rgba(0,0,0,0)');
                ctx.fillStyle = g; ctx.fillRect(c-w/2, c-h, w, h*2);
            };
            drawRay(0.6, 40*rayScale, 0.9);
            ctx.save(); ctx.translate(c, c); ctx.rotate(Math.PI/2); ctx.translate(-c, -c); drawRay(0.6, 30*rayScale, 0.9); ctx.restore();
            
            const mat = new THREE.SpriteMaterial({ map: new THREE.CanvasTexture(canvas), transparent: true, blending: THREE.AdditiveBlending, depthWrite: false });
            const sprite = new THREE.Sprite(mat);
            const finalSize = size * (1 + (degree/maxDegree)*0.5);
            sprite.scale.set(finalSize, finalSize, 1);
            sprite.userData = { phase: Math.random()*Math.PI*2, baseScale: finalSize, currentOpacity: 1.0, speed: 0.5+Math.random() };
            return sprite;
        }

        // ÂàùÂßãÂåñÂõæË°®
        Graph = ForceGraph3D()(document.getElementById('3d-graph'))
            .jsonUrl('./posts_data.json')
            .backgroundColor('#000000')
            .nodeLabel(null)
            .linkThreeObject(link => {
                const geo = new THREE.BufferGeometry();
                geo.setAttribute('position', new THREE.BufferAttribute(new Float32Array(6), 3));
                geo.setAttribute('color', new THREE.BufferAttribute(new Float32Array([0.5,0.5,0.5, 0.5,0.5,0.5]), 3));
                const mat = new THREE.LineBasicMaterial({ vertexColors: true, transparent: true, opacity: 0.15 });
                const line = new THREE.Line(geo, mat); link.__lineObj = line; return line;
            })
            .linkPositionUpdate((line, { start, end }) => {
                const p = line.geometry.attributes.position.array;
                p[0]=start.x; p[1]=start.y; p[2]=start.z; p[3]=end.x; p[4]=end.y; p[5]=end.z;
                line.geometry.attributes.position.needsUpdate = true; return true; 
            })
            .nodeThreeObject(node => {
                const degree = (node.neighbors && node.neighbors.length) || 0;
                let color = getStarColor(degree); node.color = color; 
                const group = new THREE.Group();
                const sprite = createGlowSprite(color, 12, degree); group.add(sprite); group.sprite = sprite;
                const text = new SpriteText(node.label); text.color = '#fff'; text.textHeight = 4; text.position.y = -16;
                text.material.transparent = true; text.material.opacity = 0; text.material.depthWrite = false;
                group.add(text); group.text = text; return group;
            })
            .onNodeHover(node => {
                if(modal.classList.contains('active')) return;
                hoverNode = node || null; document.body.style.cursor = node ? 'pointer' : null;
                highlightNodes.clear(); highlightLinks.clear();
                if (node) {
                    highlightNodes.add(node);
                    if(node.neighbors) node.neighbors.forEach(n => highlightNodes.add(n));
                    Graph.graphData().links.forEach(l => { if (l.source.id === node.id || l.target.id === node.id) highlightLinks.add(l); });
                }
            })
            .onNodeClick(node => {
                if(!node) return;
                const cam = Graph.camera(); initialCameraPos = { x: cam.position.x, y: cam.position.y, z: cam.position.z };
                const ratio = 1 + 60/Math.hypot(node.x, node.y, node.z);
                Graph.cameraPosition({ x: node.x*ratio, y: node.y*ratio, z: node.z*ratio }, node, 1000);
                setTimeout(() => openArticle(node), 1000);
            });

        // Âç†‰ΩçÁ¨¶ÁªßÁª≠ÂÜôÂÖ•...
        // SCRIPT_PART_2_PLACEHOLDER
    </script>
</body>
</html>